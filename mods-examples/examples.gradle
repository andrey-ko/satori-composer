examples.add(project)

task generateCompositionImage(type: GenerateCompositionDiagramTask) {
  group "codegen"
  cfgPath = file("res/com/satori/mods/resources/config.json")
  imgPath = file("docs/files/diagram.png")
  blockWidth = 220
  blockHeight = 45
}

startScripts {
  //applicationName = 'app'
  defaultJvmOpts = ["-server", "-d64"]
  optsEnvironmentVar = "APP_OPTS"
}

task generateReadme(type: TransformTask) {
  group 'codegen'
  dependsOn generateCompositionImage

  println projectDir.name
  template new File(buildscript.sourceFile.parentFile, "readme.template.md")
  output file("readme.md")
  outputs.upToDateWhen { false }
}
generateCode.dependsOn generateReadme


task generateLogProperties(type: TransformTask) {
  group 'codegen'
  template = new File(buildscript.sourceFile.parentFile, "log.template.properties")
  output = file("res/com/satori/mods/resources/log.properties")
}

task generateDockerFile(type: TransformTask) {
  group 'codegen'
  template = new File(buildscript.sourceFile.parentFile, "dockerfile.template")
  output = file("Dockerfile")
}

task buildDockerImage(type: DockerBuildImageTask) {
  group 'docker'
  dependsOn 'installDist'

  imageName = project.name
  imageTag = project.version

  contextDir = installDist.destinationDir
  prepareContext {
    copy {
      from 'Dockerfile'
      into contextDir
    }
  }
  cleanupContext {
    //delete new File(contextDir, "Dockerfile")
  }
}

task runDockerContainer(type: DockerRunContainerTask) {
  group 'docker'
  dependsOn 'buildDockerImage'

  imageName = project.name
  containerName = project.name
}


task stopDockerContainer(type: DockerStopContainerTask) {
  group 'docker'

  containerName = project.name
}
